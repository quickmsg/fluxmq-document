(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{559:function(s,t,a){s.exports=a.p+"assets/img/auth.f0bac482.png"},560:function(s,t,a){s.exports=a.p+"assets/img/fixed.d16e282a.png"},561:function(s,t,a){s.exports=a.p+"assets/img/http.75a1a908.png"},562:function(s,t,a){s.exports=a.p+"assets/img/sql-1.39983529.png"},852:function(s,t,a){"use strict";a.r(t);var r=a(25),n=Object(r.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"认证管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#认证管理"}},[s._v("#")]),s._v(" 认证管理")]),s._v(" "),t("p",[s._v("身份认证是大多数应用的重要组成部分，MQTT 协议支持用户名密码认证，启用身份认证能有效阻止非法客户端的连接。FluxMQ支持配配置多个认证方式，当配置多认证时候，连接会依次尝试认证，只要有一种认证方式通过即可连接成功。")]),s._v(" "),t("h2",{attrs:{id:"认证实体"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#认证实体"}},[s._v("#")]),s._v(" 认证实体")]),s._v(" "),t("h3",{attrs:{id:"未开启haproxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#未开启haproxy"}},[s._v("#")]),s._v(" 未开启HAProxy")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clientId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Akjdksdnfdjsnfjk"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  \n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"password"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yess"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),t("h3",{attrs:{id:"开启haproxy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启haproxy"}},[s._v("#")]),s._v(" 开启HAProxy")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clientId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Akjdksdnfdjsnfjk"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  \n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"password"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yess"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"destinationAddress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"destinationPort"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1883")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sourcePort"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1883")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sourceAddress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"12.12.12.12"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),t("p",[s._v("如果TLS终结在HAProxy层，则认证实体如下：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"clientId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Akjdksdnfdjsnfjk"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  \n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"username"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"password"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yess"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"destinationAddress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"destinationPort"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1883")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sourcePort"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1883")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sourceAddress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"12.12.12.12"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ssl"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jhbzsuiy238"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sslCn"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clientId"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"sslVersion"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TLS1.3"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),t("h2",{attrs:{id:"认证方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#认证方式"}},[s._v("#")]),s._v(" 认证方式")]),s._v(" "),t("p",[t("img",{attrs:{src:a(559),alt:"img.png"}})]),s._v(" "),t("p",[s._v("现在新增认证管理器支持正则匹配clientId,定向路由认证管理器,可以操作clientId、username,具体语法如下：")]),s._v(" "),t("ul",[t("li",[s._v("客户端ID匹配正则 "),t("code",[s._v("Client{regex}")])]),s._v(" "),t("li",[s._v("用户名匹配正则  "),t("code",[s._v("User{regex}")])])]),s._v(" "),t("p",[s._v("如果不配置正则表达式，表示匹配所有，所有请求都将会走该认证管理器。")]),s._v(" "),t("h3",{attrs:{id:"固定密码认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#固定密码认证"}},[s._v("#")]),s._v(" 固定密码认证")]),s._v(" "),t("blockquote",[t("p",[s._v("固定密码认证是指所有客户端使用相同的密码进行认证，这种方式适用于客户端数量较少的场景，例如测试环境。\n这种方式配置无法检验具体的客户端ID，生产环境慎重使用。")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(560),alt:"img.png"}})]),s._v(" "),t("h3",{attrs:{id:"http认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http认证"}},[s._v("#")]),s._v(" HTTP认证")]),s._v(" "),t("blockquote",[t("p",[s._v("HTTP认证是指客户端连接时，通过HTTP接口进行认证，这种方式适用于客户端数量较多的场景，例如生产环境。\n默认只支持POST请求，请求Content-Type为application/json，请求体为上述认证实体。 HTTP认证返回状态码为200时，认证成功，否则认证失败。")])]),s._v(" "),t("p",[t("img",{attrs:{src:a(561),alt:"img.png"}})]),s._v(" "),t("h3",{attrs:{id:"sql认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql认证"}},[s._v("#")]),s._v(" SQL认证")]),s._v(" "),t("blockquote",[t("p",[s._v("SQL认证是指客户端连接时，通过SQL语句进行认证，这种方式适用于客户端数量较多的场景，例如生产环境。")])]),s._v(" "),t("p",[s._v("默认采用POST请求，Context-Type: Application/Json, 可以使用占位符去获取认证实体中的任意字段。")]),s._v(" "),t("h4",{attrs:{id:"选择对应数据驱动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#选择对应数据驱动"}},[s._v("#")]),s._v(" 选择对应数据驱动")]),s._v(" "),t("blockquote",[t("p",[s._v("FluxMQ支持Mysql、PostgreSQL、Oracle、SQLServer等数据库，选择对应的数据驱动。\n"),t("img",{attrs:{src:a(562),alt:"img.png"}})])]),s._v(" "),t("h4",{attrs:{id:"配置认证sql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置认证sql"}},[s._v("#")]),s._v(" 配置认证SQL")]),s._v(" "),t("blockquote",[t("p",[s._v("使用 ${认证实体变量名}去引用认证实体中的属性，例如：${username} 代表认证实体中的username属性。查询只要存在记录就认证成功，否则认证失败。")])]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" fluxmq "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" username "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${username}'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" password "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${password}'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" clientId "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'${clientId}'")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);