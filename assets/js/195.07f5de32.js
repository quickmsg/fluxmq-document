(window.webpackJsonp=window.webpackJsonp||[]).push([[195],{610:function(t,s,a){t.exports=a.p+"assets/img/rule_6.d2ed9589.png"},664:function(t,s,a){"use strict";a.r(s);var r=a(25),e=Object(r.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("a",{attrs:{id:"jump2"}},[t._v("SQL 事件类型与字段")])]),t._v(" "),s("h1",{attrs:{id:"sql-事件类型与字段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sql-事件类型与字段"}},[t._v("#")]),t._v(" SQL 事件类型与字段")]),t._v(" "),s("p",[t._v("规则的 SQL 语句可以处理 MQTT事件 消息，或者是具有数据流入能力的数据桥接。"),s("br"),t._v("SQL 语句使用 FROM 来指定 MQTT事件，在 SELECT 和 WHERE 子句中可以引用相应的字段。 "),s("br"),t._v("数据源类型不同，可以使用的字段也不同。")]),t._v(" "),s("h2",{attrs:{id:"客户端事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端事件"}},[t._v("#")]),t._v(" 客户端事件")]),t._v(" "),s("p",[t._v("规则的 SQL 语句可以处理事件(发布消息、客户端上下线、客户端订阅等)，FROM 子句后面跟事件主题。"),s("br"),t._v("事件主题以 $EVENT/ 开头，比如 $EVENT.PUBLISH,$EVENT.SUBSCRIBE 。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("事件名称")])]),t._v(" "),s("th",[s("strong",[t._v("事件主题名")])]),t._v(" "),s("th",[s("strong",[t._v("释义")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("发布事件")]),t._v(" "),s("td",[t._v("$EVENT.PUBLISH")]),t._v(" "),s("td",[t._v("发布消息")])]),t._v(" "),s("tr",[s("td",[t._v("订阅事件")]),t._v(" "),s("td",[t._v("$EVENT.SUBSCRIBE")]),t._v(" "),s("td",[t._v("订阅成功消息")])]),t._v(" "),s("tr",[s("td",[t._v("取消订阅事件")]),t._v(" "),s("td",[t._v("$EVENT.UNSUBSCRIBE")]),t._v(" "),s("td",[t._v("取消订阅成功消息")])]),t._v(" "),s("tr",[s("td",[t._v("发布回复事件")]),t._v(" "),s("td",[t._v("$EVENT.ACK")]),t._v(" "),s("td",[t._v("消息接收成功并回复")])]),t._v(" "),s("tr",[s("td",[t._v("心跳事件")]),t._v(" "),s("td",[t._v("$EVENT.PING")]),t._v(" "),s("td",[t._v("连接保活心跳消息")])]),t._v(" "),s("tr",[s("td",[t._v("取消连接事件")]),t._v(" "),s("td",[t._v("$EVENT.DISCONNECT")]),t._v(" "),s("td",[t._v("客户端主动断开连接")])]),t._v(" "),s("tr",[s("td",[t._v("连接断开事件")]),t._v(" "),s("td",[t._v("$EVENT.CLOSE")]),t._v(" "),s("td",[t._v("服务端关闭连接")])]),t._v(" "),s("tr",[s("td",[t._v("建立连接事件")]),t._v(" "),s("td",[t._v("$EVENT.CONNECT")]),t._v(" "),s("td",[t._v("连接成功")])]),t._v(" "),s("tr",[s("td",[t._v("离线消息事件")]),t._v(" "),s("td",[t._v("$EVENT.OFFLINE")]),t._v(" "),s("td",[t._v("离线期间接收的消息")])])])]),t._v(" "),s("h3",{attrs:{id:"发布事件-event-publish"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布事件-event-publish"}},[t._v("#")]),t._v(' 发布事件 ("$EVENT.PUBLISH")')]),t._v(" "),s("p",[t._v("当消息被放入底层socket时触发规则。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",[t._v("消息唯一标识,客户端publish会生成唯一Id,当qos>0时候，Ack消息会携带此id，代表一次完成应答操作")])]),t._v(" "),s("tr",[s("td",[t._v("payload")]),t._v(" "),s("td",[t._v("MQTT 消息体")])]),t._v(" "),s("tr",[s("td",[t._v("messageId")]),t._v(" "),s("td",[t._v("MQTT 消息 ID")])]),t._v(" "),s("tr",[s("td",[t._v("topic")]),t._v(" "),s("td",[t._v("MQTT 主题")])]),t._v(" "),s("tr",[s("td",[t._v("qos")]),t._v(" "),s("td",[t._v("MQTT 消息的 QoS")])]),t._v(" "),s("tr",[s("td",[t._v("retain")]),t._v(" "),s("td",[t._v("MQTT 消息是否保持")])]),t._v(" "),s("tr",[s("td",[t._v("timestamp")]),t._v(" "),s("td",[t._v("事件触发时间 (单位：毫秒)")])]),t._v(" "),s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])]),t._v(" "),s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.PUBLISH"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8ace2bbab65b4fb1a0afc7c77419e6b5"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"payload"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messageId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"topic"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"qos"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"retain"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1690599987495"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183.136.225.31"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.12"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"发布回复事件-event-ack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布回复事件-event-ack"}},[t._v("#")]),t._v(' 发布回复事件 ("$EVENT.ACK")')]),t._v(" "),s("p",[t._v("当消息发送到客户端，并收到客户端回复的ack时触发规则，仅QOS1，QOS2会触发。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",[t._v("消息唯一标识,客户端publish会生成唯一Id,当qos>0时候，Ack消息会携带此id，代表一次完成应答操作")])]),t._v(" "),s("tr",[s("td",[t._v("payload")]),t._v(" "),s("td",[t._v("MQTT 消息体")])]),t._v(" "),s("tr",[s("td",[t._v("messageId")]),t._v(" "),s("td",[t._v("MQTT 消息 ID")])]),t._v(" "),s("tr",[s("td",[t._v("topic")]),t._v(" "),s("td",[t._v("MQTT 主题")])]),t._v(" "),s("tr",[s("td",[t._v("qos")]),t._v(" "),s("td",[t._v("MQTT 消息的 QoS")])]),t._v(" "),s("tr",[s("td",[t._v("timestamp")]),t._v(" "),s("td",[t._v("事件触发时间 (单位：毫秒)")])]),t._v(" "),s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])]),t._v(" "),s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("desc")]),t._v(" "),s("td",[t._v("回复描述，用于区分qos1,2消息回复")])])])]),t._v(" "),s("ul",[s("li",[t._v("desc字段枚举")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("ack")]),t._v(" "),s("td",[t._v("QoS1 回复")])]),t._v(" "),s("tr",[s("td",[t._v("rec")]),t._v(" "),s("td",[t._v("QoS2 发布确认")])]),t._v(" "),s("tr",[s("td",[t._v("comp")]),t._v(" "),s("td",[t._v("QoS2 发布完成")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.ACK"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8ace2bbab65b4fb1a0afc7c77419e6b5"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messageId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10001")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"payload"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"topic"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"qos"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1690599987495"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183.136.225.31"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"desc"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ack"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"建立连接事件-event-connect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建立连接事件-event-connect"}},[t._v("#")]),t._v(' 建立连接事件 ("$EVENT.CONNECT")')]),t._v(" "),s("p",[t._v("当客户端连接成功时触发规则。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("version")]),t._v(" "),s("td",[t._v("使用的协议 版本")])]),t._v(" "),s("tr",[s("td",[t._v("keepalive")]),t._v(" "),s("td",[t._v("MQTT 保活间隔")])]),t._v(" "),s("tr",[s("td",[t._v("cleanSession")]),t._v(" "),s("td",[t._v("是否清空会话")])]),t._v(" "),s("tr",[s("td",[t._v("auth.username")]),t._v(" "),s("td",[t._v("客户端用户名")])]),t._v(" "),s("tr",[s("td",[t._v("auth.password")]),t._v(" "),s("td",[t._v("客户端密码")])]),t._v(" "),s("tr",[s("td",[t._v("will.isRetain")]),t._v(" "),s("td",[t._v("遗嘱消息是否保持")])]),t._v(" "),s("tr",[s("td",[t._v("will.willTopic")]),t._v(" "),s("td",[t._v("遗嘱消息主题")])]),t._v(" "),s("tr",[s("td",[t._v("will.willQos")]),t._v(" "),s("td",[t._v("遗嘱消息语义级别")])]),t._v(" "),s("tr",[s("td",[t._v("will.willMessage")]),t._v(" "),s("td",[t._v("遗嘱消息内容")])]),t._v(" "),s("tr",[s("td",[t._v("timestamp")]),t._v(" "),s("td",[t._v("事件触发时间 (单位：毫秒)")])]),t._v(" "),s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.CONNECT"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.0.100"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"MQTT_3_1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"keepalive"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"cleanSession"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"auth"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"username"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fluxmq"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"password"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fluxmq"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"will"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"isRetain"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"willTopic"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"willTest"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"willQos"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"willMessage"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1690599987495"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"取消连接事件-event-disconnect"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#取消连接事件-event-disconnect"}},[t._v("#")]),t._v(' 取消连接事件 ("$EVENT/DISCONNECT")')]),t._v(" "),s("p",[t._v("当客户端连接断开时触发规则。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])]),t._v(" "),s("tr",[s("td",[t._v("time")]),t._v(" "),s("td",[t._v("事件触发时间")])]),t._v(" "),s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.DISCONNECT"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"time"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022 12-22 12:00:00"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183.136.225.31"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"订阅事件-event-subscribe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#订阅事件-event-subscribe"}},[t._v("#")]),t._v(' 订阅事件 ("$EVENT/SUBSCRIBE")')]),t._v(" "),s("p",[t._v("当客户端订阅成功时触发规则。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("messageId")]),t._v(" "),s("td",[t._v("MQTT 消息 ID")])]),t._v(" "),s("tr",[s("td",[t._v("topic")]),t._v(" "),s("td",[t._v("MQTT 主题")])]),t._v(" "),s("tr",[s("td",[t._v("qos")]),t._v(" "),s("td",[t._v("MQTT 消息的 QoS")])]),t._v(" "),s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])]),t._v(" "),s("tr",[s("td",[t._v("timestamp")]),t._v(" "),s("td",[t._v("事件触发时间")])]),t._v(" "),s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.SUBSCRIBE"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messageId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"topic"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"qos"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183.136.225.31:21950"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1690599987495"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.12"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"客户端取消订阅成功事件-event-unsubscribe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端取消订阅成功事件-event-unsubscribe"}},[t._v("#")]),t._v(' 客户端取消订阅成功事件 ("$EVENT/UNSUBSCRIBE")')]),t._v(" "),s("p",[t._v("当客户端取消订阅成功时触发规则。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("messageId")]),t._v(" "),s("td",[t._v("MQTT 消息 ID")])]),t._v(" "),s("tr",[s("td",[t._v("topic")]),t._v(" "),s("td",[t._v("MQTT 主题")])]),t._v(" "),s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])]),t._v(" "),s("tr",[s("td",[t._v("timestamp")]),t._v(" "),s("td",[t._v("事件触发时间")])]),t._v(" "),s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.UNSUBSCRIBE"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messageId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"topic"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183.136.225.31:21950"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1690599987495"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"心跳事件-event-ping"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#心跳事件-event-ping"}},[t._v("#")]),t._v(' 心跳事件 ("$EVENT.PING")')]),t._v(" "),s("p",[t._v("当客户端推送保活心跳时触发规则。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])]),t._v(" "),s("tr",[s("td",[t._v("timestamp")]),t._v(" "),s("td",[t._v("事件触发时间")])]),t._v(" "),s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.PING"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1690599987495"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183.136.225.31"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"连接断开事件-event-close"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#连接断开事件-event-close"}},[t._v("#")]),t._v(' 连接断开事件 ("$EVENT.CLOSE")')]),t._v(" "),s("p",[t._v("当服务端关闭连接时触发规则。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("messageId")]),t._v(" "),s("td",[t._v("MQTT 消息 ID")])]),t._v(" "),s("tr",[s("td",[t._v("reason")]),t._v(" "),s("td",[t._v("连接断开原因描述")])]),t._v(" "),s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])]),t._v(" "),s("tr",[s("td",[t._v("timestamp")]),t._v(" "),s("td",[t._v("事件触发时间")])]),t._v(" "),s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])])])]),t._v(" "),s("p",[s("code",[t._v("reason")]),t._v("连接断开原因：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("normal")]),t._v(" "),s("td",[t._v("客户端关闭")])]),t._v(" "),s("tr",[s("td",[t._v("kicked")]),t._v(" "),s("td",[t._v("服务端主动关闭")])]),t._v(" "),s("tr",[s("td",[t._v("timeout")]),t._v(" "),s("td",[t._v("客户端心跳超时关闭")])]),t._v(" "),s("tr",[s("td",[t._v("not_authorized")]),t._v(" "),s("td",[t._v("认证失败关闭")])]),t._v(" "),s("tr",[s("td",[t._v("other_kicked")]),t._v(" "),s("td",[t._v("集群互踢")])]),t._v(" "),s("tr",[s("td",[t._v("disconnect")]),t._v(" "),s("td",[t._v("客户端主动关闭")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.CLOSE"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messageId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"reason"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1690599987495"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183.136.225.31"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"离线消息事件-event-offline"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#离线消息事件-event-offline"}},[t._v("#")]),t._v(' 离线消息事件 ("$EVENT.OFFLINE")')]),t._v(" "),s("ul",[s("li",[t._v("离线消息必须是Qos=1或者Qos=2的消息")]),t._v(" "),s("li",[t._v("当客户端发布的消息没有客户端订阅时，那么此消息被定义为离线消息")]),t._v(" "),s("li",[t._v("ACK未确认的qos=1或者qos=2的消息，也会被定义为离线消息")])]),t._v(" "),s("p",[t._v("配置"),s("strong",[t._v("离线消息")]),t._v("，将离线消息持久化到Mysql，Redis，PostgreSQL数据库中。"),s("br"),t._v("配置"),s("strong",[t._v("订阅消息")]),t._v("，将离线消息根据订阅主题推送给客户端。"),s("br"),t._v("配置"),s("strong",[t._v("发布回复")]),t._v("，根据客户端的ACK回复，从数据库中删除离线消息。"),s("br"),t._v("即同时选择：离线消息、订阅消息、发布回复三种类型。"),s("br"),t._v("可以为SQL添加topic过滤条件，比如topic =~ 'test/#'"),s("br"),s("img",{attrs:{src:a(610),alt:""}})]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("字段")])]),t._v(" "),s("th",[s("strong",[t._v("解释")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",[t._v("消息唯一标识")])]),t._v(" "),s("tr",[s("td",[t._v("payload")]),t._v(" "),s("td",[t._v("MQTT 消息体")])]),t._v(" "),s("tr",[s("td",[t._v("messageId")]),t._v(" "),s("td",[t._v("MQTT 消息 ID")])]),t._v(" "),s("tr",[s("td",[t._v("topic")]),t._v(" "),s("td",[t._v("MQTT 主题")])]),t._v(" "),s("tr",[s("td",[t._v("qos")]),t._v(" "),s("td",[t._v("MQTT 消息的 QoS")])]),t._v(" "),s("tr",[s("td",[t._v("retain")]),t._v(" "),s("td",[t._v("MQTT 消息是否保持")])]),t._v(" "),s("tr",[s("td",[t._v("timestamp")]),t._v(" "),s("td",[t._v("事件触发时间 (单位：毫秒)")])]),t._v(" "),s("tr",[s("td",[t._v("clientId")]),t._v(" "),s("td",[t._v("客户端 ID")])]),t._v(" "),s("tr",[s("td",[t._v("clientIp")]),t._v(" "),s("td",[t._v("客户端的 IPAddress")])]),t._v(" "),s("tr",[s("td",[t._v("nodeIp")]),t._v(" "),s("td",[t._v("事件触发所在节点 IPAddress")])])])]),t._v(" "),s("p",[t._v("示例")]),t._v(" "),s("div",{staticClass:"language-plsql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-plsql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("select")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$EVENT.OFFLINE"')]),t._v("\n")])])]),s("p",[t._v("输出")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8ace2bbab65b4fb1a0afc7c77419e6b5"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"payload"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"messageId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"topic"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"qos"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"retain"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"timestamp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1690599987495"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientId"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A1212313"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"clientIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"183.136.225.31"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"nodeIp"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"192.168.1.1"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);